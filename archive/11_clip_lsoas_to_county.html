

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Create a map of the Ambulance Service regions &#8212; stroke_unit_demographics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'archive/11_clip_lsoas_to_county';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">stroke_unit_demographics</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Stroke unit demographics
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_combine_demographic_data.html">Collate demographic data for each LSOA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01b_ambulance_trusts.html">Ambulance Trusts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_create_shapefiles.html">Create shapefiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02b_create_regions_for_streamlit_app.html">Create simplified regions for Streamlit app</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_create_maps.html">Create maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03b_results_by_region.html">Create region-averaged data</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Farchive/11_clip_lsoas_to_county.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/archive/11_clip_lsoas_to_county.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Create a map of the Ambulance Service regions</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Create a map of the Ambulance Service regions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#new-approach-with-county-lookup-files">NEW APPROACH WITH COUNTY LOOKUP FILES</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#used-qgis-to-find-out-why-there-s-holes">Used QGIS to find out why there’s holes</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="create-a-map-of-the-ambulance-service-regions">
<h1>Create a map of the Ambulance Service regions<a class="headerlink" href="#create-a-map-of-the-ambulance-service-regions" title="Permalink to this heading">#</a></h1>
<p>In England and Wales there are 11 Ambulance Services.</p>
<p>An image of the Ambulance Service catchments can be found at <a class="reference external" href="https://aace.org.uk/uk-ambulance-service/map-of-nhs-ambulance-services/">https://aace.org.uk/uk-ambulance-service/map-of-nhs-ambulance-services/</a> (Association of Ambulance Cheif Executives).</p>
<p>We have been advised by Steve Irving (Executive Officer / ALF Conference Lead) that the map “is just an approximation of the boundaries, purely for illustrative / navigational purposes”.</p>
<p>We aim to build a map of the Ambulance Service regions from the individual LSOAs up.</p>
<p>Here we link together two datafiles that take us from LSOA to CCG, and then from CCG to Ambulance Service:</p>
<ol class="arabic simple">
<li><p>LSOA to CCG (Lower_Layer_Super_Output_Area_(2011)<em>to_Clinical_Commissioning_Group_to_Local_Authority_District</em>(April_2021)_Lookup_in_England.csv)</p></li>
<li><p>CCG to Ambulance Service (“ambulance_service_info.xlsx”, sheet Ambulance CCG lookup. Extracted and created “ambulance_service_info_ccg_lookup.csv”). Do not use “NHS Ambulance Service Region Name” as this is not a name per Ambulance Service. Instead set up a dictionary and create a new field “Ambulance Service Name” from the code contained in the field “Ambulane Service”.</p></li>
</ol>
<p>There is a complications using this approach. Two CCGs are split across two Ambulance Services:</p>
<ol class="arabic simple">
<li><p>NHS Hampshire, Southampton and Isle of Wight CCG is partly covered by Isle of Wight Ambulance Service, partly by SCAS.</p></li>
<li><p>NHS Bedfordshire, Luton and Milton Keynes CCG is partly covered by EEAST, partly by SCAS.</p></li>
</ol>
<p>We manage this by taking this approach:</p>
<ol class="arabic simple">
<li><p>All LSOA names containing “Isle of Wight” get assigned to Isle of Wight Ambulance Service, the rest of the LSOAs that make up the “NHS Hampshire, Southampton and Isle of Wight CCG” get assigned to SCAS.</p></li>
<li><p>NHS Bedfordshire, Luton and Milton Keynes CCG spans two counties: Bedfordshire and Buckinhamshire. The catchemnt maps on the respective Ambulance Service websites showed that the Ambulance Service EEAST serves the county of Bedfordhsire, and the Ambulance Service SCAS serves the county of Buckinghamshire. Using a shapefile of the UK Counties, extract the individual polygons for i) Bedfordshire ii) Buckinghamshire and in turn use these to identify the LSOAs in each. For the LSOAs in the NHS Bedfordshire, Luton and Milton Keynes CCG, use their location in relation to these two counties to determine whether they are part of the EEAST or SCAS.</p></li>
</ol>
<p>Another complication is that Wales is not included in the LSOA to CCG datafile, and so would otherwise not be included in this analysis.</p>
<p>Note: Code cell “gdf_beds_lsoa = gpd.clip(gdf_beds_county, gdf_lsoa)” takes a few hours to run. So read in the created shapefile (same for the Bucks equivalent)</p>
<p><a class="reference external" href="https://geoportal.statistics.gov.uk/datasets/ons::oa-2021-to-ward-to-ltla-to-utla-to-region-to-country-may-2022-lookup-in-england-and-wales-v2/explore">https://geoportal.statistics.gov.uk/datasets/ons::oa-2021-to-ward-to-ltla-to-utla-to-region-to-country-may-2022-lookup-in-england-and-wales-v2/explore</a></p>
<p><a class="reference external" href="https://geoportal.statistics.gov.uk/datasets/ons::lower-layer-super-output-area-2011-to-ward-2020-lookup-in-england-and-wales-1/explore">https://geoportal.statistics.gov.uk/datasets/ons::lower-layer-super-output-area-2011-to-ward-2020-lookup-in-england-and-wales-1/explore</a></p>
<p>LSOA to County source:
<a class="reference external" href="https://opendata.camden.gov.uk/widgets/tr8t-gqz7">https://opendata.camden.gov.uk/widgets/tr8t-gqz7</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">ctx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">Bbox</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">zoomed_inset_axes</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">mark_inset</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 4&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">ctx</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">import</span> <span class="nn">os</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;contextily&#39;
</pre></div>
</div>
</div>
</div>
<p>Source for County shapefile: <a class="reference external" href="https://www.ukpostcode.net/shapefile-of-uk-administrative-counties-wiki-16.html">https://www.ukpostcode.net/shapefile-of-uk-administrative-counties-wiki-16.html</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;zip://./data/uk_admin_map_shapefile.zip&#39;</span>
<span class="n">gdf_county</span><span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
<span class="n">gdf_county</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID_0</th>
      <th>ISO</th>
      <th>NAME_0</th>
      <th>ID_1</th>
      <th>NAME_1</th>
      <th>ID_2</th>
      <th>NAME_2</th>
      <th>VARNAME_2</th>
      <th>NL_NAME_2</th>
      <th>HASC_2</th>
      <th>CC_2</th>
      <th>TYPE_2</th>
      <th>ENGTYPE_2</th>
      <th>VALIDFR_2</th>
      <th>VALIDTO_2</th>
      <th>REMARKS_2</th>
      <th>Shape_Leng</th>
      <th>Shape_Area</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>80</td>
      <td>GBR</td>
      <td>United Kingdom</td>
      <td>1030</td>
      <td>England</td>
      <td>13936</td>
      <td>Barking and Dagenham</td>
      <td>None</td>
      <td>None</td>
      <td>GB.BA</td>
      <td>None</td>
      <td>London Borough</td>
      <td>London Borough</td>
      <td>None</td>
      <td>Present</td>
      <td>None</td>
      <td>0.368272</td>
      <td>0.004932</td>
      <td>POLYGON ((719316.591 5716960.249, 719365.616 5...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>80</td>
      <td>GBR</td>
      <td>United Kingdom</td>
      <td>1030</td>
      <td>England</td>
      <td>13937</td>
      <td>Bath and North East Somerset</td>
      <td>None</td>
      <td>None</td>
      <td>GB.BN</td>
      <td>None</td>
      <td>Unitary Authority</td>
      <td>Unitary Authority</td>
      <td>19960401</td>
      <td>Present</td>
      <td>None</td>
      <td>1.146163</td>
      <td>0.039882</td>
      <td>POLYGON ((550019.968 5696813.117, 550299.618 5...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_county</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d21412a85ca0bf2d63ea77ace5b82abbfa1b9b7f40a9dbb5459c39f6da25e5f9.png" src="../_images/d21412a85ca0bf2d63ea77ace5b82abbfa1b9b7f40a9dbb5459c39f6da25e5f9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;zip://./data/Counties_and_Unitary_Authorities__December_2017__Boundaries_UK-shp.zip&#39;</span>
<span class="n">gdf_county_ua</span><span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
<span class="n">gdf_county_ua</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>objectid</th>
      <th>ctyua17cd</th>
      <th>ctyua17nm</th>
      <th>ctyua17nmw</th>
      <th>bng_e</th>
      <th>bng_n</th>
      <th>long</th>
      <th>lat</th>
      <th>st_areasha</th>
      <th>st_lengths</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>E06000001</td>
      <td>Hartlepool</td>
      <td>None</td>
      <td>447157</td>
      <td>531476</td>
      <td>-1.27023</td>
      <td>54.676159</td>
      <td>9.355951e+07</td>
      <td>71707.407523</td>
      <td>MULTIPOLYGON (((447213.900 537036.104, 447228....</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>E06000002</td>
      <td>Middlesbrough</td>
      <td>None</td>
      <td>451141</td>
      <td>516887</td>
      <td>-1.21099</td>
      <td>54.544670</td>
      <td>5.388858e+07</td>
      <td>43840.866561</td>
      <td>MULTIPOLYGON (((448958.901 521835.695, 449045....</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_county_ua</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/018f9dfb6c46541471f48b4f1ca59047f372d423485982753610f3c872a8a4fd.png" src="../_images/018f9dfb6c46541471f48b4f1ca59047f372d423485982753610f3c872a8a4fd.png" />
</div>
</div>
<p>Put both county shapefiles on one plot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># When using base maps convert data to epsg:3857</span>
<span class="n">gdf_county</span> <span class="o">=</span> <span class="n">gdf_county</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
<span class="n">gdf_county_ua</span> <span class="o">=</span> <span class="n">gdf_county_ua</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_county</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">gdf_county_ua</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">set_xlim</span><span class="o">=</span><span class="p">([</span><span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">set_ylim</span><span class="o">=</span><span class="p">([</span><span class="mi">650</span><span class="p">,</span> <span class="mi">750</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/599280237810cb126e041e6da1f9284dcc709dd8275d2c9d4606960d6ff74365.png" src="../_images/599280237810cb126e041e6da1f9284dcc709dd8275d2c9d4606960d6ff74365.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-750000, 250000]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_county_ua</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">gdf_county</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/f8ae814c568dd742b842b6cc97b42f9d85f8272aa2a6d5f76abce43e7dc98a26.png" src="../_images/f8ae814c568dd742b842b6cc97b42f9d85f8272aa2a6d5f76abce43e7dc98a26.png" />
</div>
</div>
<p>Extract the two counties need to divide the LSOAs between.</p>
<p>** KP note that so far only used “Bedfordshire” and “Buckinghamshire”, whereas also need to add to Bedfordshire “Luton”, and to Buckinghmashire “Milton Keynes”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">gdf_county</span><span class="p">[</span><span class="s2">&quot;NAME_2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Bedfordshire&quot;</span>
<span class="n">gdf_beds_county</span> <span class="o">=</span> <span class="n">gdf_county</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">gdf_county</span><span class="p">[</span><span class="s2">&quot;NAME_2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Buckinghamshire&quot;</span>
<span class="n">gdf_bucks_county</span> <span class="o">=</span> <span class="n">gdf_county</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Read in LSOA shapefile</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;zip://./data/Lower_layer_super_output_areas_(E+W)_2011_Boundaries_(Generalised_Clipped)_V2.zip&#39;</span>
<span class="n">gdf_lsoa</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
<span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LSOA11CD</th>
      <th>LSOA11NM</th>
      <th>LSOA11NMW</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E01000001</td>
      <td>City of London 001A</td>
      <td>City of London 001A</td>
      <td>POLYGON ((532105.092 182011.230, 532162.491 18...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E01000002</td>
      <td>City of London 001B</td>
      <td>City of London 001B</td>
      <td>POLYGON ((532746.813 181786.891, 532671.688 18...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>E01000003</td>
      <td>City of London 001C</td>
      <td>City of London 001C</td>
      <td>POLYGON ((532135.145 182198.119, 532158.250 18...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>E01000005</td>
      <td>City of London 001E</td>
      <td>City of London 001E</td>
      <td>POLYGON ((533807.946 180767.770, 533649.063 18...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E01000006</td>
      <td>Barking and Dagenham 016A</td>
      <td>Barking and Dagenham 016A</td>
      <td>POLYGON ((545122.049 184314.931, 545271.917 18...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;zip://./data/Lower_Layer_Super_Output_Area_(2011)_to_Ward_(2020)_Lookup_in_England_and_Wales.gdb.zip&#39;</span>
<span class="n">gdf_ward</span><span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
<span class="n">gdf_ward</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LSOA11CD</th>
      <th>LSOA11NM</th>
      <th>WD20CD</th>
      <th>WD20NM</th>
      <th>LAD20CD</th>
      <th>LAD20NM</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E01011949</td>
      <td>Hartlepool 009A</td>
      <td>E05008945</td>
      <td>Foggy Furze</td>
      <td>E06000001</td>
      <td>Hartlepool</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E01012162</td>
      <td>Redcar and Cleveland 012A</td>
      <td>E05012454</td>
      <td>Skelton East</td>
      <td>E06000003</td>
      <td>Redcar and Cleveland</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_lsoa</span><span class="p">[</span><span class="s2">&quot;LSOA11NM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;edford&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Series([], Name: LSOA11NM, dtype: object)
</pre></div>
</div>
</div>
</div>
<p>Find LSOAs that are in Bedfordshire, and give them Ambulance Service “East of England”.
Find LSOAs that are in Buckinghamshire, and give them Ambulance Service “South Central”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># When using base maps convert data to epsg:3857</span>
<span class="n">gdf_lsoa</span> <span class="o">=</span> <span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
<span class="n">gdf_beds_county</span> <span class="o">=</span> <span class="n">gdf_beds_county</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
<span class="n">gdf_bucks_county</span> <span class="o">=</span> <span class="n">gdf_bucks_county</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Check location of county sits within LSOA maps (check the crs match across all three shapefiles)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">gdf_beds_county</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">gdf_bucks_county</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/a8edd7ad5ad1c81727443980669c876e016b95083cd141cd2c90e7687745b64c.png" src="../_images/a8edd7ad5ad1c81727443980669c876e016b95083cd141cd2c90e7687745b64c.png" />
</div>
</div>
<p>Limit the LSOA shapefile to the boundary around the county polygon, before do clip method, to save a lot of processing time</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beds_county_bounds</span> <span class="o">=</span> <span class="n">gdf_beds_county</span><span class="o">.</span><span class="n">bounds</span>
<span class="n">minx</span><span class="p">,</span><span class="n">miny</span><span class="p">,</span><span class="n">maxx</span><span class="p">,</span><span class="n">maxy</span> <span class="o">=</span>  <span class="n">beds_county_bounds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">gdf_beds_lsoa_box</span> <span class="o">=</span> <span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span><span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d4e75bc38a954919f28a17becda24323f2f16fba3b9d7b362f79196940ca3d7a.png" src="../_images/d4e75bc38a954919f28a17becda24323f2f16fba3b9d7b362f79196940ca3d7a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data/lsoa_bedfordshire_box.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_county</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/9dd4ba971c1aea3ee0f735bd145c8583ab7c4a798fe80ab927314f44702e6d56.png" src="../_images/9dd4ba971c1aea3ee0f735bd145c8583ab7c4a798fe80ab927314f44702e6d56.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_county_geometry</span> <span class="o">=</span> <span class="n">gdf_beds_county</span><span class="o">.</span><span class="n">geometry</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_county_geometry</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2    POLYGON ((-41311.888 6848688.907, -41002.642 6...
Name: geometry, dtype: geometry
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check for LSOA overlapping with, or completely within, Devon &amp; Cornwall</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">overlaps</span><span class="p">(</span><span class="n">gdf_beds_county_geometry</span><span class="p">))</span><span class="c1"># | (gdf_beds_lsoa_box.within(gdf_beds_county))</span>
<span class="c1">#mask = gdf_beds_lsoa_box.within(gdf_beds_county)</span>
<span class="n">gdf_beds_lsoa</span> <span class="o">=</span> <span class="n">gdf_beds_lsoa_box</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/kerry/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/base.py:39: UserWarning: The indices of the two GeoSeries are different.
  warn(&quot;The indices of the two GeoSeries are different.&quot;)
/home/kerry/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/geodataframe.py:828: UserWarning: Boolean Series key will be reindexed to match DataFrame index.
  result = super(GeoDataFrame, self).__getitem__(key)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LSOA11CD</th>
      <th>LSOA11NM</th>
      <th>LSOA11NMW</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15225</th>
      <td>E01015693</td>
      <td>Luton 007A</td>
      <td>Luton 007A</td>
      <td>POLYGON ((-46419.247 6783036.594, -46408.496 6...</td>
    </tr>
    <tr>
      <th>15226</th>
      <td>E01015694</td>
      <td>Luton 007B</td>
      <td>Luton 007B</td>
      <td>POLYGON ((-46615.661 6782608.227, -46596.131 6...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_county</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID_0</th>
      <th>ISO</th>
      <th>NAME_0</th>
      <th>ID_1</th>
      <th>NAME_1</th>
      <th>ID_2</th>
      <th>NAME_2</th>
      <th>VARNAME_2</th>
      <th>NL_NAME_2</th>
      <th>HASC_2</th>
      <th>CC_2</th>
      <th>TYPE_2</th>
      <th>ENGTYPE_2</th>
      <th>VALIDFR_2</th>
      <th>VALIDTO_2</th>
      <th>REMARKS_2</th>
      <th>Shape_Leng</th>
      <th>Shape_Area</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>80</td>
      <td>GBR</td>
      <td>United Kingdom</td>
      <td>1030</td>
      <td>England</td>
      <td>13938</td>
      <td>Bedfordshire</td>
      <td>None</td>
      <td>None</td>
      <td>GB.BD</td>
      <td>None</td>
      <td>Administrative County</td>
      <td>Administrative County</td>
      <td>~1989</td>
      <td>Present</td>
      <td>None</td>
      <td>2.158565</td>
      <td>0.147815</td>
      <td>POLYGON ((-41311.888 6848688.907, -41002.642 6...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LSOA11CD</th>
      <th>LSOA11NM</th>
      <th>LSOA11NMW</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="c1">#gdf_lsoa.plot(ax=ax)</span>
<span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/kerry/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/plotting.py:607: UserWarning: The GeoDataFrame you are attempting to plot is empty. Nothing has been displayed.
  UserWarning,
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/7358134376439344ba1e8e7bf3136f2542ad77a39a1e8fc52bc7cd57a9dfa442.png" src="../_images/7358134376439344ba1e8e7bf3136f2542ad77a39a1e8fc52bc7cd57a9dfa442.png" />
</div>
</div>
<p><a class="reference external" href="https://www.tomasbeuzen.com/python-for-geospatial-analysis/chapters/chapter1_intro-to-spatial.html">https://www.tomasbeuzen.com/python-for-geospatial-analysis/chapters/chapter1_intro-to-spatial.html</a></p>
<p>Take the LSOAs that sit wtihin the county polygon. Using the Clip method: “think of “clipping” as passing a top layer of cookie dough (the map above), over a bottom layer cookiecutter (our high-resolution provinces data) to get a shape out”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;data/bedfordshire_lsoas1.shp&quot;</span>
<span class="n">exist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">if</span> <span class="n">exist</span><span class="p">:</span>
    <span class="c1"># Read in</span>
    <span class="n">gdf_beds_lsoa</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Create IVT catchment shapefile by dissolving LSOA polygons</span>
    <span class="n">gdf_beds_lsoa</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gdf_beds_lsoa_box</span><span class="p">,</span> <span class="n">gdf_beds_county</span><span class="p">)</span>

    <span class="c1"># Save a shapefile of the catchments for each IVT</span>
    <span class="n">gdf_beds_lsoa</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TopologyException: Input geom 0 is invalid: Ring Self-intersection at or near point -48331.645175062782 6821220.2919420162 at -48331.645175062782 6821220.2919420162
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TopologicalError</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="n">cb9edbb95e16</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="c1"># Create IVT catchment shapefile by dissolving LSOA polygons</span>
<span class="ne">----&gt; </span><span class="mi">9</span>     <span class="n">gdf_beds_lsoa</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gdf_beds_lsoa_box</span><span class="p">,</span> <span class="n">gdf_beds_county</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> 
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="c1"># Save a shapefile of the catchments for each IVT</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/tools/clip.py</span> in <span class="ni">clip</span><span class="nt">(gdf, mask, keep_geom_type)</span>
<span class="g g-Whitespace">    </span><span class="mi">167</span> 
<span class="g g-Whitespace">    </span><span class="mi">168</span>     <span class="k">if</span> <span class="n">poly_idx</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">169</span>         <span class="n">poly_gdf</span> <span class="o">=</span> <span class="n">_clip_line_poly</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="n">poly_idx</span><span class="p">],</span> <span class="n">poly</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">170</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span>         <span class="n">poly_gdf</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/tools/clip.py</span> in <span class="ni">_clip_line_poly</span><span class="nt">(gdf, poly)</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gdf_sub</span><span class="p">,</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span>         <span class="n">clipped</span> <span class="o">=</span> <span class="n">gdf_sub</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">69</span>         <span class="n">clipped</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_sub</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span>         <span class="c1"># GeoSeries</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/base.py</span> in <span class="ni">intersection</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">560</span>             <span class="n">intersection</span> <span class="k">with</span><span class="o">.</span>
<span class="g g-Whitespace">    </span><span class="mi">561</span><span class="w">         </span><span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">562</span><span class="sd">         return _binary_geo(&quot;intersection&quot;, self, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">564</span><span class="sd">     #</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/base.py</span> in <span class="ni">_binary_geo</span><span class="nt">(op, this, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span><span class="sd">     from .geoseries import GeoSeries</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span><span class="sd"> </span>
<span class="ne">---&gt; </span><span class="mi">60</span><span class="sd">     geoms, index = _delegate_binary_method(op, this, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span><span class="sd">     return GeoSeries(geoms.data, index=index, crs=this.crs)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span><span class="sd"> </span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/base.py</span> in <span class="ni">_delegate_binary_method</span><span class="nt">(op, this, other, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span><span class="sd">         raise TypeError(type(this), type(other))</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span><span class="sd"> </span>
<span class="ne">---&gt; </span><span class="mi">51</span><span class="sd">     data = getattr(a_this, op)(other, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span><span class="sd">     return data, this.index</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span><span class="sd"> </span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/array.py</span> in <span class="ni">intersection</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">551</span><span class="sd">     def intersection(self, other):</span>
<span class="g g-Whitespace">    </span><span class="mi">552</span><span class="sd">         return GeometryArray(</span>
<span class="ne">--&gt; </span><span class="mi">553</span><span class="sd">             self._binary_method(&quot;intersection&quot;, self, other), crs=self.crs</span>
<span class="g g-Whitespace">    </span><span class="mi">554</span><span class="sd">         )</span>
<span class="g g-Whitespace">    </span><span class="mi">555</span><span class="sd"> </span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/array.py</span> in <span class="ni">_binary_method</span><span class="nt">(op, left, right, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span><span class="sd">             right = right.data</span>
<span class="g g-Whitespace">    </span><span class="mi">484</span><span class="sd"> </span>
<span class="ne">--&gt; </span><span class="mi">485</span><span class="sd">         return getattr(vectorized, op)(left.data, right, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">486</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">487</span><span class="sd">     def covers(self, other):</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/_vectorized.py</span> in <span class="ni">intersection</span><span class="nt">(data, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">721</span><span class="sd">         return _binary_method(&quot;intersection&quot;, data, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">722</span><span class="sd">     else:</span>
<span class="ne">--&gt; </span><span class="mi">723</span><span class="sd">         return _binary_geo(&quot;intersection&quot;, data, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">724</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">725</span><span class="sd"> </span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/_vectorized.py</span> in <span class="ni">_binary_geo</span><span class="nt">(op, left, right)</span>
<span class="g g-Whitespace">    </span><span class="mi">283</span><span class="sd">         data[:] = [</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span><span class="sd">             getattr(s, op)(right) if s is not None and right is not None else None</span>
<span class="ne">--&gt; </span><span class="mi">285</span><span class="sd">             for s in left</span>
<span class="g g-Whitespace">    </span><span class="mi">286</span><span class="sd">         ]</span>
<span class="g g-Whitespace">    </span><span class="mi">287</span><span class="sd">         return data</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/_vectorized.py</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">283</span><span class="sd">         data[:] = [</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span><span class="sd">             getattr(s, op)(right) if s is not None and right is not None else None</span>
<span class="ne">--&gt; </span><span class="mi">285</span><span class="sd">             for s in left</span>
<span class="g g-Whitespace">    </span><span class="mi">286</span><span class="sd">         ]</span>
<span class="g g-Whitespace">    </span><span class="mi">287</span><span class="sd">         return data</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/shapely/geometry/base.py</span> in <span class="ni">intersection</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">674</span><span class="sd">     def intersection(self, other):</span>
<span class="g g-Whitespace">    </span><span class="mi">675</span><span class="sd">         &quot;&quot;&quot;</span><span class="n">Returns</span> <span class="n">the</span> <span class="n">intersection</span> <span class="n">of</span> <span class="n">the</span> <span class="n">geometries</span><span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">676</span><span class="s2">         return geom_factory(self.impl[&#39;intersection&#39;](self, other))</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">678</span><span class="s2">     def symmetric_difference(self, other):</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/shapely/topology.py</span> in <span class="ni">__call__</span><span class="nt">(self, this, other, *args)</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span><span class="s2">             err = TopologicalError(</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span><span class="s2">                     &quot;This operation could not be performed. Reason: unknown&quot;)</span>
<span class="ne">---&gt; </span><span class="mi">70</span><span class="s2">             self._check_topology(err, this, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span><span class="s2">         return product</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span><span class="s2"> </span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/shapely/topology.py</span> in <span class="ni">_check_topology</span><span class="nt">(self, err, *geoms)</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span><span class="s2">                     &quot;The operation &#39;</span><span class="si">%s</span><span class="s2">&#39; could not be performed. &quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span><span class="s2">                     &quot;Likely cause is invalidity of the geometry </span><span class="si">%s</span><span class="s2">&quot; % (</span>
<span class="ne">---&gt; </span><span class="mi">38</span><span class="s2">                         self.fn.__name__, repr(geom)))</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span><span class="s2">         raise err</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span><span class="s2"> </span>

<span class="ne">TopologicalError</span>: The operation &#39;GEOSIntersection_r&#39; could not be performed. Likely cause is invalidity of the geometry &lt;shapely.geometry.polygon.Polygon object at 0x7fecc6cb5d90&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_county</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bucks_county_bounds</span> <span class="o">=</span> <span class="n">gdf_bucks_county</span><span class="o">.</span><span class="n">bounds</span>
<span class="n">minx</span><span class="p">,</span><span class="n">miny</span><span class="p">,</span><span class="n">maxx</span><span class="p">,</span><span class="n">maxy</span> <span class="o">=</span>  <span class="n">bucks_county_bounds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">gdf_bucks_lsoa_box</span> <span class="o">=</span> <span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span><span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">gdf_bucks_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">gdf_bucks_county</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;data/buckinghamshire_lsoas1.shp&quot;</span>
<span class="n">exist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">if</span> <span class="n">exist</span><span class="p">:</span>
    <span class="c1"># Read in</span>
    <span class="n">gdf_bucks_lsoa</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Create IVT catchment shapefile by dissolving LSOA polygons</span>
    <span class="n">gdf_bucks_lsoa</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gdf_bucks_lsoa_box</span><span class="p">,</span> <span class="n">gdf_bucks_county</span><span class="p">)</span>

    <span class="c1"># Save a shapefile of the catchments for each IVT</span>
    <span class="n">gdf_bucks_lsoa</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">gdf_bucks_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">gdf_bucks_county</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">gdf_bucks_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>gdf_beds_lsoa = gpd.clip(gdf_beds_county, gdf_lsoa)
gdf_beds_lsoa.plot(edgecolor=”0.2”)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">gdf_beds_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">gdf_bucks_lsoa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="new-approach-with-county-lookup-files">
<h1>NEW APPROACH WITH COUNTY LOOKUP FILES<a class="headerlink" href="#new-approach-with-county-lookup-files" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lsoa_to_county</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/National_Statistics_Postcode_Lookup_UK.csv&quot;</span><span class="p">)</span>
<span class="n">lsoa_to_county</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Postcode 1</th>
      <th>Postcode 2</th>
      <th>Postcode 3</th>
      <th>Date Introduced</th>
      <th>User Type</th>
      <th>Easting</th>
      <th>Northing</th>
      <th>Positional Quality</th>
      <th>County Code</th>
      <th>County Name</th>
      <th>...</th>
      <th>Middle Super Output Area Code</th>
      <th>Middle Super Output Area Name</th>
      <th>Output Area Classification Code</th>
      <th>Output Area Classification Name</th>
      <th>Longitude</th>
      <th>Latitude</th>
      <th>Spatial Accuracy</th>
      <th>Last Uploaded</th>
      <th>Location</th>
      <th>Socrata ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>RM1 3DB</td>
      <td>RM1  3DB</td>
      <td>RM1 3DB</td>
      <td>01-1980</td>
      <td>0</td>
      <td>551820</td>
      <td>189380</td>
      <td>1</td>
      <td>E09000016</td>
      <td>NaN</td>
      <td>...</td>
      <td>E02000475</td>
      <td>Havering 012</td>
      <td>5B1</td>
      <td>Urbanites;Ageing urban living;Delayed retirement</td>
      <td>0.189869</td>
      <td>51.582836</td>
      <td>Postcode Level</td>
      <td>05/12/2022</td>
      <td>(51.582836, 0.189869)</td>
      <td>1320003</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SM1 4NR</td>
      <td>SM1  4NR</td>
      <td>SM1 4NR</td>
      <td>01-1980</td>
      <td>0</td>
      <td>526554</td>
      <td>164361</td>
      <td>1</td>
      <td>E09000029</td>
      <td>NaN</td>
      <td>...</td>
      <td>E02000852</td>
      <td>Sutton 013</td>
      <td>4C3</td>
      <td>Multicultural metropolitans;Asian traits;Inner...</td>
      <td>-0.183560</td>
      <td>51.364224</td>
      <td>Postcode Level</td>
      <td>05/12/2022</td>
      <td>(51.364224, -0.18356)</td>
      <td>1447628</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 36 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;County Code&quot;</span><span class="p">,</span><span class="s2">&quot;County Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Lower Super Output Area Code&quot;</span><span class="p">]</span>
<span class="n">lsoa_to_county_trim</span> <span class="o">=</span> <span class="n">lsoa_to_county</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
<span class="n">lsoa_to_county_trim</span> <span class="o">=</span> <span class="n">lsoa_to_county_trim</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">lsoa_to_county_trim</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>County Code</th>
      <th>County Name</th>
      <th>Lower Super Output Area Code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E09000016</td>
      <td>NaN</td>
      <td>E01002354</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E09000029</td>
      <td>NaN</td>
      <td>E01004139</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lsoa_to_county_trim</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/National_Statistics_Postcode_Lookup_UK_trim_lsoa_county.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beds_county_bounds</span> <span class="o">=</span> <span class="n">gdf_beds_county</span><span class="o">.</span><span class="n">bounds</span>
<span class="n">minx</span><span class="p">,</span><span class="n">miny</span><span class="p">,</span><span class="n">maxx</span><span class="p">,</span><span class="n">maxy</span> <span class="o">=</span>  <span class="n">beds_county_bounds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">gdf_beds_lsoa_box</span> <span class="o">=</span> <span class="n">gdf_lsoa</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="n">minx</span><span class="p">:</span><span class="n">maxx</span><span class="p">,</span><span class="n">miny</span><span class="p">:</span><span class="n">maxy</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LSOA11CD</th>
      <th>LSOA11NM</th>
      <th>LSOA11NMW</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15225</th>
      <td>E01015693</td>
      <td>Luton 007A</td>
      <td>Luton 007A</td>
      <td>POLYGON ((-46419.247 6783036.594, -46408.496 6...</td>
    </tr>
    <tr>
      <th>15226</th>
      <td>E01015694</td>
      <td>Luton 007B</td>
      <td>Luton 007B</td>
      <td>POLYGON ((-46615.661 6782608.227, -46596.131 6...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;LSOA11CD&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lsoa_to_county_trim</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Lower Super Output Area Code&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lsoa_to_county_trim</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>County Code</th>
      <th>County Name</th>
    </tr>
    <tr>
      <th>Lower Super Output Area Code</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>E01002354</th>
      <td>E09000016</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>E01004139</th>
      <td>E09000029</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa_box</span> <span class="o">=</span> <span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lsoa_to_county_trim</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LSOA11CD</th>
      <th>LSOA11NM</th>
      <th>LSOA11NMW</th>
      <th>geometry</th>
      <th>County Code</th>
      <th>County Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E01015693</td>
      <td>Luton 007A</td>
      <td>Luton 007A</td>
      <td>POLYGON ((-46419.247 6783036.594, -46408.496 6...</td>
      <td>E06000032</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E01015694</td>
      <td>Luton 007B</td>
      <td>Luton 007B</td>
      <td>POLYGON ((-46615.661 6782608.227, -46596.131 6...</td>
      <td>E06000032</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="c1"># Set which axes to use for plot (only one here)</span>
                 <span class="n">column</span><span class="o">=</span><span class="s2">&quot;County Code&quot;</span><span class="p">,</span> <span class="c1"># Column to apply colour</span>
                 <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># Avoids artifact boundry lines</span>
                 <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;face&#39;</span><span class="p">,</span> <span class="c1"># Make LSOA boundry same colour as area</span>
                 <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="c1"># Use linewidth=0 to hide boarder lines</span>
<span class="c1">#                 vmin=0, # Manual scale min (remove to make automatic)</span>
<span class="c1">#                 vmax=70, # Manual scale max (remove to make automatic)</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno_r&#39;</span><span class="p">,</span>
                      <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/d83cca70034e9ef1b5cba7718774783df27a467a3c93eea3ad35f2c2764367ff.png" src="../_images/d83cca70034e9ef1b5cba7718774783df27a467a3c93eea3ad35f2c2764367ff.png" />
</div>
</div>
<p>County Code Names
Luton: E06000032
Milton keynes: E06000042
Bedford: E06000055
Central Bedfordshure: E06000056
Bucks: E06000060
North Northamptonshire: E06000061
Cambridgeshire: E10000003
Hertfordshire: E10000015</p>
<section id="used-qgis-to-find-out-why-there-s-holes">
<h2>Used QGIS to find out why there’s holes<a class="headerlink" href="#used-qgis-to-find-out-why-there-s-holes" title="Permalink to this heading">#</a></h2>
<p>It’s just because the oa to county file (data/National_Statistics_Postcode_Lookup_UK.csv) appears to be incomplete for those missing LSOAs. Not an issue with the join.</p>
<p>:(</p>
<p>But did find another shapefile for Counties (from UA)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;zip://./data/Counties_and_Unitary_Authorities__December_2017__Boundaries_UK-shp.zip&#39;</span>
<span class="n">gdf_county_ua</span><span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
<span class="n">gdf_county_ua</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>objectid</th>
      <th>ctyua17cd</th>
      <th>ctyua17nm</th>
      <th>ctyua17nmw</th>
      <th>bng_e</th>
      <th>bng_n</th>
      <th>long</th>
      <th>lat</th>
      <th>st_areasha</th>
      <th>st_lengths</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>E06000001</td>
      <td>Hartlepool</td>
      <td>None</td>
      <td>447157</td>
      <td>531476</td>
      <td>-1.27023</td>
      <td>54.676159</td>
      <td>9.355951e+07</td>
      <td>71707.407523</td>
      <td>MULTIPOLYGON (((447213.900 537036.104, 447228....</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>E06000002</td>
      <td>Middlesbrough</td>
      <td>None</td>
      <td>451141</td>
      <td>516887</td>
      <td>-1.21099</td>
      <td>54.544670</td>
      <td>5.388858e+07</td>
      <td>43840.866561</td>
      <td>MULTIPOLYGON (((448958.901 521835.695, 449045....</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_county_ua</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f81c186281e307d3fe26fc5bb469810d21ca0ba8f056657ffb1fbbc31f47b7b8.png" src="../_images/f81c186281e307d3fe26fc5bb469810d21ca0ba8f056657ffb1fbbc31f47b7b8.png" />
</div>
</div>
<p>Join up the 3 polygons to make up Bedford county and try to use this to “.clip” the LSOA shapefile (spoiler - you will see it gives the same error as before, so the issue seems to be with the LSOA shapefile.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdf_county_ua</span><span class="p">[</span><span class="s2">&quot;ctyua17nm&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Bedford&quot;</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">gdf_county_ua</span><span class="p">[</span><span class="s2">&quot;ctyua17nm&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Central Bedfordshire&quot;</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">gdf_county_ua</span><span class="p">[</span><span class="s2">&quot;ctyua17nm&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Luton&quot;</span><span class="p">)</span>
<span class="n">gdf_beds_county_ua</span> <span class="o">=</span> <span class="n">gdf_county_ua</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">gdf_beds_county_ua</span> <span class="o">=</span> <span class="n">gdf_beds_county_ua</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
<span class="n">gdf_beds_county_ua</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fcb05f037e2fa380ea9b1a211c45b2bbfc45805d4eadbfbb96b2bb6314192fa5.png" src="../_images/fcb05f037e2fa380ea9b1a211c45b2bbfc45805d4eadbfbb96b2bb6314192fa5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_county_ua</span><span class="p">[</span><span class="s1">&#39;common_column&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Yes&quot;</span>
<span class="n">gdf_beds_county_ua_merged</span> <span class="o">=</span> <span class="n">gdf_beds_county_ua</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;common_column&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_county_ua_merged</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/kerry/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/geodataframe.py:853: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  super(GeoDataFrame, self).__setitem__(key, value)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
      <th>objectid</th>
      <th>ctyua17cd</th>
      <th>ctyua17nm</th>
      <th>ctyua17nmw</th>
      <th>bng_e</th>
      <th>bng_n</th>
      <th>long</th>
      <th>lat</th>
      <th>st_areasha</th>
      <th>st_lengths</th>
    </tr>
    <tr>
      <th>common_column</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Yes</th>
      <td>POLYGON ((511131.303 225358.101, 511124.699 22...</td>
      <td>32</td>
      <td>E06000032</td>
      <td>Luton</td>
      <td>None</td>
      <td>508606</td>
      <td>222559</td>
      <td>-0.42319</td>
      <td>51.891022</td>
      <td>4.335249e+07</td>
      <td>34569.65994</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_county_ua</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fcb05f037e2fa380ea9b1a211c45b2bbfc45805d4eadbfbb96b2bb6314192fa5.png" src="../_images/fcb05f037e2fa380ea9b1a211c45b2bbfc45805d4eadbfbb96b2bb6314192fa5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_county_ua</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data/bedfordshire_county_from_3uas.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_county_ua</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/4ebf94b9b18d744aae161237db9203b2132fd3fb8e5bdb6c65fb449b913db8cc.png" src="../_images/4ebf94b9b18d744aae161237db9203b2132fd3fb8e5bdb6c65fb449b913db8cc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gdf_beds_lsoa_box</span><span class="p">,</span> <span class="n">gdf_beds_county_ua</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TopologyException: Input geom 0 is invalid: Ring Self-intersection at or near point -48331.645175062782 6821220.2919420162 at -48331.645175062782 6821220.2919420162
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TopologicalError</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">97</span><span class="o">-</span><span class="mi">6</span><span class="n">b4146d08579</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">gdf_beds_lsoa</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gdf_beds_lsoa_box</span><span class="p">,</span> <span class="n">gdf_beds_county_ua</span><span class="p">)</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/tools/clip.py</span> in <span class="ni">clip</span><span class="nt">(gdf, mask, keep_geom_type)</span>
<span class="g g-Whitespace">    </span><span class="mi">167</span> 
<span class="g g-Whitespace">    </span><span class="mi">168</span>     <span class="k">if</span> <span class="n">poly_idx</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">169</span>         <span class="n">poly_gdf</span> <span class="o">=</span> <span class="n">_clip_line_poly</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="n">poly_idx</span><span class="p">],</span> <span class="n">poly</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">170</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span>         <span class="n">poly_gdf</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/tools/clip.py</span> in <span class="ni">_clip_line_poly</span><span class="nt">(gdf, poly)</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gdf_sub</span><span class="p">,</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span>         <span class="n">clipped</span> <span class="o">=</span> <span class="n">gdf_sub</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">69</span>         <span class="n">clipped</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_sub</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span>         <span class="c1"># GeoSeries</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/base.py</span> in <span class="ni">intersection</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">560</span>             <span class="n">intersection</span> <span class="k">with</span><span class="o">.</span>
<span class="g g-Whitespace">    </span><span class="mi">561</span><span class="w">         </span><span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">562</span><span class="sd">         return _binary_geo(&quot;intersection&quot;, self, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">564</span><span class="sd">     #</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/base.py</span> in <span class="ni">_binary_geo</span><span class="nt">(op, this, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span><span class="sd">     from .geoseries import GeoSeries</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span><span class="sd"> </span>
<span class="ne">---&gt; </span><span class="mi">60</span><span class="sd">     geoms, index = _delegate_binary_method(op, this, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span><span class="sd">     return GeoSeries(geoms.data, index=index, crs=this.crs)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span><span class="sd"> </span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/base.py</span> in <span class="ni">_delegate_binary_method</span><span class="nt">(op, this, other, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span><span class="sd">         raise TypeError(type(this), type(other))</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span><span class="sd"> </span>
<span class="ne">---&gt; </span><span class="mi">51</span><span class="sd">     data = getattr(a_this, op)(other, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span><span class="sd">     return data, this.index</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span><span class="sd"> </span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/array.py</span> in <span class="ni">intersection</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">551</span><span class="sd">     def intersection(self, other):</span>
<span class="g g-Whitespace">    </span><span class="mi">552</span><span class="sd">         return GeometryArray(</span>
<span class="ne">--&gt; </span><span class="mi">553</span><span class="sd">             self._binary_method(&quot;intersection&quot;, self, other), crs=self.crs</span>
<span class="g g-Whitespace">    </span><span class="mi">554</span><span class="sd">         )</span>
<span class="g g-Whitespace">    </span><span class="mi">555</span><span class="sd"> </span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/array.py</span> in <span class="ni">_binary_method</span><span class="nt">(op, left, right, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span><span class="sd">             right = right.data</span>
<span class="g g-Whitespace">    </span><span class="mi">484</span><span class="sd"> </span>
<span class="ne">--&gt; </span><span class="mi">485</span><span class="sd">         return getattr(vectorized, op)(left.data, right, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">486</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">487</span><span class="sd">     def covers(self, other):</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/_vectorized.py</span> in <span class="ni">intersection</span><span class="nt">(data, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">721</span><span class="sd">         return _binary_method(&quot;intersection&quot;, data, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">722</span><span class="sd">     else:</span>
<span class="ne">--&gt; </span><span class="mi">723</span><span class="sd">         return _binary_geo(&quot;intersection&quot;, data, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">724</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">725</span><span class="sd"> </span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/_vectorized.py</span> in <span class="ni">_binary_geo</span><span class="nt">(op, left, right)</span>
<span class="g g-Whitespace">    </span><span class="mi">283</span><span class="sd">         data[:] = [</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span><span class="sd">             getattr(s, op)(right) if s is not None and right is not None else None</span>
<span class="ne">--&gt; </span><span class="mi">285</span><span class="sd">             for s in left</span>
<span class="g g-Whitespace">    </span><span class="mi">286</span><span class="sd">         ]</span>
<span class="g g-Whitespace">    </span><span class="mi">287</span><span class="sd">         return data</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/_vectorized.py</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">283</span><span class="sd">         data[:] = [</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span><span class="sd">             getattr(s, op)(right) if s is not None and right is not None else None</span>
<span class="ne">--&gt; </span><span class="mi">285</span><span class="sd">             for s in left</span>
<span class="g g-Whitespace">    </span><span class="mi">286</span><span class="sd">         ]</span>
<span class="g g-Whitespace">    </span><span class="mi">287</span><span class="sd">         return data</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/shapely/geometry/base.py</span> in <span class="ni">intersection</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">    </span><span class="mi">674</span><span class="sd">     def intersection(self, other):</span>
<span class="g g-Whitespace">    </span><span class="mi">675</span><span class="sd">         &quot;&quot;&quot;</span><span class="n">Returns</span> <span class="n">the</span> <span class="n">intersection</span> <span class="n">of</span> <span class="n">the</span> <span class="n">geometries</span><span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">676</span><span class="s2">         return geom_factory(self.impl[&#39;intersection&#39;](self, other))</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">678</span><span class="s2">     def symmetric_difference(self, other):</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/shapely/topology.py</span> in <span class="ni">__call__</span><span class="nt">(self, this, other, *args)</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span><span class="s2">             err = TopologicalError(</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span><span class="s2">                     &quot;This operation could not be performed. Reason: unknown&quot;)</span>
<span class="ne">---&gt; </span><span class="mi">70</span><span class="s2">             self._check_topology(err, this, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span><span class="s2">         return product</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span><span class="s2"> </span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/shapely/topology.py</span> in <span class="ni">_check_topology</span><span class="nt">(self, err, *geoms)</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span><span class="s2">                     &quot;The operation &#39;</span><span class="si">%s</span><span class="s2">&#39; could not be performed. &quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span><span class="s2">                     &quot;Likely cause is invalidity of the geometry </span><span class="si">%s</span><span class="s2">&quot; % (</span>
<span class="ne">---&gt; </span><span class="mi">38</span><span class="s2">                         self.fn.__name__, repr(geom)))</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span><span class="s2">         raise err</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span><span class="s2"> </span>

<span class="ne">TopologicalError</span>: The operation &#39;GEOSIntersection_r&#39; could not be performed. Likely cause is invalidity of the geometry &lt;shapely.geometry.polygon.Polygon object at 0x7fecc6cb5d90&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;zip://./data/Lower_Layer_Super_Output_Areas_December_2011_Full_Clipped__Boundaries_in_England_and_Wales.zip&#39;</span>
<span class="n">gdf_lsoa_1</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
<span class="n">gdf_lsoa_1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">CPLE_OpenFailedError</span><span class="g g-Whitespace">                      </span>Traceback (most recent call last)
<span class="nn">fiona/_shim.pyx</span> in <span class="ni">fiona._shim.gdal_open_vector</span><span class="nt">()</span>

<span class="nn">fiona/_err.pyx</span> in <span class="ni">fiona._err.exc_wrap_pointer</span><span class="nt">()</span>

<span class="ne">CPLE_OpenFailedError</span>: &#39;/vsizip/./data/Lower_Layer_Super_Output_Areas_December_2011_Full_Clipped__Boundaries_in_England_and_Wales.zip&#39; does not exist in the file system, and is not recognized as a supported dataset name.

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">DriverError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">99</span><span class="o">-</span><span class="n">c0c54aaad796</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;zip://./data/Lower_Layer_Super_Output_Areas_December_2011_Full_Clipped__Boundaries_in_England_and_Wales.zip&#39;</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">gdf_lsoa_1</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">gdf_lsoa_1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/geopandas/io/file.py</span> in <span class="ni">_read_file</span><span class="nt">(filename, bbox, mask, rows, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span> 
<span class="g g-Whitespace">     </span><span class="mi">95</span>     <span class="k">with</span> <span class="n">fiona_env</span><span class="p">():</span>
<span class="ne">---&gt; </span><span class="mi">96</span>         <span class="k">with</span> <span class="n">reader</span><span class="p">(</span><span class="n">path_or_bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">features</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span> 
<span class="g g-Whitespace">     </span><span class="mi">98</span>             <span class="c1"># In a future Fiona release the crs attribute of features will</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/fiona/env.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">396</span>     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span>         <span class="k">if</span> <span class="n">local</span><span class="o">.</span><span class="n">_env</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">398</span>             <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">399</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>             <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/fiona/__init__.py</span> in <span class="ni">open</span><span class="nt">(fp, mode, driver, schema, crs, encoding, layer, vfs, enabled_drivers, crs_wkt, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span>         <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span>             <span class="n">c</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">254</span>                            <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span> <span class="n">enabled_drivers</span><span class="o">=</span><span class="n">enabled_drivers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">255</span>         <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">256</span>             <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/fiona/collection.py</span> in <span class="ni">__init__</span><span class="nt">(self, path, mode, driver, schema, crs, encoding, layer, vsi, archive, enabled_drivers, crs_wkt, ignore_fields, ignore_geometry, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">154</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span>             <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">WritingSession</span><span class="p">()</span>

<span class="nn">fiona/ogrext.pyx</span> in <span class="ni">fiona.ogrext.Session.start</span><span class="nt">()</span>

<span class="nn">fiona/_shim.pyx</span> in <span class="ni">fiona._shim.gdal_open_vector</span><span class="nt">()</span>

<span class="ne">DriverError</span>: &#39;/vsizip/./data/Lower_Layer_Super_Output_Areas_December_2011_Full_Clipped__Boundaries_in_England_and_Wales.zip&#39; does not exist in the file system, and is not recognized as a supported dataset name.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_lsoa_1</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>Followed how to clip in QGIS (lsoa_bedfordshire_box.shp and bedfordshire_county_from_3uas.shp)
<a class="reference external" href="https://www.youtube.com/watch?v=U3pngCq3TFw">https://www.youtube.com/watch?v=U3pngCq3TFw</a>
Created “bedfordshire_lsoas.gpkg”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;data/bedfordshire_lsoas.gpkg&quot;</span>
<span class="n">gdf_beds_lsoa_qgis</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:27700&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_lsoa_qgis</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3e145f95bc9d6e1ad9a3664b73f8e42afd9aeb83e1bb729d4d21a24497c49d1b.png" src="../_images/3e145f95bc9d6e1ad9a3664b73f8e42afd9aeb83e1bb729d4d21a24497c49d1b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_county_ua</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_lsoa_qgis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/7e9e4bb1ebc6656aac80a98fdc0397e796c93c5e01b2856cc15bbcb9eda580d2.png" src="../_images/7e9e4bb1ebc6656aac80a98fdc0397e796c93c5e01b2856cc15bbcb9eda580d2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">extra_lsoa_in_bedford</span> <span class="o">=</span> <span class="s2">&quot;E01017486&quot;</span>
<span class="c1"># This exists in &quot;gdf_beds_lsoa_box&quot;, but not currently in &quot;gdf_beds_lsoa_qgis&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">gdf_beds_lsoa_box</span><span class="p">[</span><span class="s1">&#39;LSOA11CD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">extra_lsoa_in_bedford</span>
<span class="n">gdf_beds_lsoa_qgis_plusone</span> <span class="o">=</span> <span class="n">gdf_beds_lsoa_qgis</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="n">gdf_beds_lsoa_qgis_plusone</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">nrows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>431
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa_qgis_plusone</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">nrows</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_beds_lsoa_box</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">gdf_beds_lsoa_qgis_plusone</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IndexError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">109</span><span class="o">-</span><span class="mi">665</span><span class="n">a5bbcec8f</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">gdf_beds_lsoa_qgis_plusone</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">nrows</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_beds_lsoa_box</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">gdf_beds_lsoa_qgis_plusone</span><span class="o">.</span><span class="n">shape</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/pandas/core/indexing.py</span> in <span class="ni">__setitem__</span><span class="nt">(self, key, value)</span>
<span class="g g-Whitespace">    </span><span class="mi">665</span>             <span class="n">key</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">apply_if_callable</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">666</span>         <span class="n">indexer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_setitem_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">667</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_has_valid_setitem_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">668</span> 
<span class="g g-Whitespace">    </span><span class="mi">669</span>         <span class="n">iloc</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;iloc&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">iloc</span>

<span class="nn">~/anaconda3/envs/geopandas/lib/python3.7/site-packages/pandas/core/indexing.py</span> in <span class="ni">_has_valid_setitem_indexer</span><span class="nt">(self, indexer)</span>
<span class="g g-Whitespace">   </span><span class="mi">1392</span>                 <span class="k">elif</span> <span class="n">is_integer</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1393</span>                     <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1394</span>                         <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;iloc cannot enlarge its target object&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1395</span>                 <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1396</span>                     <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;iloc cannot enlarge its target object&quot;</span><span class="p">)</span>

<span class="ne">IndexError</span>: iloc cannot enlarge its target object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa_box</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LSOA11CD</th>
      <th>LSOA11NM</th>
      <th>LSOA11NMW</th>
      <th>geometry</th>
      <th>County Code</th>
      <th>County Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>247</th>
      <td>E01017486</td>
      <td>Bedford 019A</td>
      <td>Bedford 019A</td>
      <td>POLYGON ((-48331.645 6821220.292, -48326.382 6...</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_beds_lsoa_qgis_plusone</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LSOA11CD</th>
      <th>LSOA11NM</th>
      <th>LSOA11NMW</th>
      <th>County Cod</th>
      <th>County Nam</th>
      <th>National_Statistics_Postcode_Lookup_UK_trim_lsoa_county_County Code</th>
      <th>National_Statistics_Postcode_Lookup_UK_trim_lsoa_county_County Name</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E01015693</td>
      <td>Luton 007A</td>
      <td>Luton 007A</td>
      <td>E06000032</td>
      <td>None</td>
      <td>E06000032</td>
      <td>None</td>
      <td>MULTIPOLYGON (((-46419.247 6783036.594, -46408...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E01015694</td>
      <td>Luton 007B</td>
      <td>Luton 007B</td>
      <td>E06000032</td>
      <td>None</td>
      <td>E06000032</td>
      <td>None</td>
      <td>MULTIPOLYGON (((-46615.661 6782608.227, -46596...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_county_ua</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_lsoa_qgis_plusone</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># Make max dimensions 10x10 inch</span>
<span class="n">gdf_beds_lsoa_box</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_county_ua</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">gdf_beds_lsoa_qgis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./archive"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Create a map of the Ambulance Service regions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#new-approach-with-county-lookup-files">NEW APPROACH WITH COUNTY LOOKUP FILES</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#used-qgis-to-find-out-why-there-s-holes">Used QGIS to find out why there’s holes</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By SAMueL-2 team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>