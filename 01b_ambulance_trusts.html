

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Ambulance Trusts &#8212; stroke_unit_demographics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '01b_ambulance_trusts';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Create shapefiles" href="02_create_shapefiles.html" />
    <link rel="prev" title="Collate demographic data for each LSOA" href="01_combine_demographic_data.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">stroke_unit_demographics</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Stroke unit demographics
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_combine_demographic_data.html">Collate demographic data for each LSOA</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Ambulance Trusts</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_create_shapefiles.html">Create shapefiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="02b_create_regions_for_streamlit_app.html">Create simplified regions for Streamlit app</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_create_maps.html">Create maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="03b_results_by_region.html">Create region-averaged data</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F01b_ambulance_trusts.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/01b_ambulance_trusts.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ambulance Trusts</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">1 Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages-and-set-file-paths">2 Import packages and set file paths</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">3 Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#existing-maps-of-ambulance-boundaries">3.1 Existing maps of ambulance boundaries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#existing-spreadsheets-which-identify-ambulance-boundaries">3.2 Existing spreadsheets which identify ambulance boundaries</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-lsoa-to-ambulance-service-based-on-lookup-files">4 Create LSOA to Ambulance Service based on lookup files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-nhs-hampshire-southampton-and-isle-of-wight-ccg">5 Add NHS Hampshire, Southampton and Isle of Wight CCG</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maps">5.1 Maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-appropriate-service-to-each-lsoa">5.2 Add appropriate service to each LSOA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-nhs-bedfordshire-luton-and-milton-keynes-ccg">6 Add NHS Bedfordshire, Luton and Milton Keynes CCG</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maps-and-information-about-the-area">6.1 Maps and information about the area</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-appropriate-services-based-on-county">6.2 Add appropriate services based on county</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-services-to-collated-data-csv">7 Add services to collated_data.csv</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-wales-to-collated-data-csv">8 Add Wales to collated_data.csv</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-file">9 Save file</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ambulance-trusts">
<h1>Ambulance Trusts<a class="headerlink" href="#ambulance-trusts" title="Permalink to this heading">#</a></h1>
<section id="summary">
<h2>1 Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p><strong>Aim:</strong> Add ambulance trust to each LSOA in collated_data.csv</p>
<p>Note: For source of images, see ‘images/image_sources.txt’.</p>
</section>
<section id="import-packages-and-set-file-paths">
<h2>2 Import packages and set file paths<a class="headerlink" href="#import-packages-and-set-file-paths" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import required packages</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="c1"># Linting</span>
<span class="o">%</span><span class="k">load_ext</span> pycodestyle_magic
<span class="o">%</span><span class="k">pycodestyle_on</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 10&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="c1"># Linting</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;load_ext&#39;</span><span class="p">,</span> <span class="s1">&#39;pycodestyle_magic&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;pycodestyle_on&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/lib/python3.9/site-packages/IPython/core/interactiveshell.py:2305,</span> in <span class="ni">InteractiveShell.run_line_magic</span><span class="nt">(self, magic_name, line, _stack_depth)</span>
<span class="g g-Whitespace">   </span><span class="mi">2303</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;local_ns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_local_scope</span><span class="p">(</span><span class="n">stack_depth</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2304</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_trap</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2305</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2306</span> <span class="k">return</span> <span class="n">result</span>

<span class="nn">File ~/miniconda3/lib/python3.9/site-packages/IPython/core/magics/extension.py:33,</span> in <span class="ni">ExtensionMagics.load_ext</span><span class="nt">(self, module_str)</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">module_str</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span>     <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s1">&#39;Missing module name.&#39;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">33</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">extension_manager</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="n">module_str</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="s1">&#39;already loaded&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The </span><span class="si">%s</span><span class="s2"> extension is already loaded. To reload it, use:&quot;</span> <span class="o">%</span> <span class="n">module_str</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/lib/python3.9/site-packages/IPython/core/extensions.py:76,</span> in <span class="ni">ExtensionManager.load_extension</span><span class="nt">(self, module_str)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Load an IPython extension by its module name.</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">71</span><span class="sd"> Returns the string &quot;already loaded&quot; if the extension is already loaded,</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span><span class="sd"> &quot;no load function&quot; if the module doesn&#39;t have a load_ipython_extension</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span><span class="sd"> function, or None if it succeeded.</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">76</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_extension</span><span class="p">(</span><span class="n">module_str</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span> <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>     <span class="k">if</span> <span class="n">module_str</span> <span class="ow">in</span> <span class="n">BUILTINS_EXTS</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/lib/python3.9/site-packages/IPython/core/extensions.py:92,</span> in <span class="ni">ExtensionManager._load_extension</span><span class="nt">(self, module_str)</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span> <span class="k">if</span> <span class="n">module_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">91</span>     <span class="k">with</span> <span class="n">prepended_to_syspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ipython_extension_dir</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">92</span>         <span class="n">mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">module_str</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>         <span class="k">if</span> <span class="n">mod</span><span class="o">.</span><span class="vm">__file__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ipython_extension_dir</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span>             <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;Loading extensions from </span><span class="si">{dir}</span><span class="s2"> is deprecated. &quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">95</span>                    <span class="s2">&quot;We recommend managing extensions like any &quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span>                    <span class="s2">&quot;other Python packages, in site-packages.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span>                   <span class="nb">dir</span><span class="o">=</span><span class="n">compress_user</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ipython_extension_dir</span><span class="p">)))</span>

<span class="nn">File ~/miniconda3/lib/python3.9/importlib/__init__.py:127,</span> in <span class="ni">import_module</span><span class="nt">(name, package)</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>             <span class="k">break</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>         <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="ne">--&gt; </span><span class="mi">127</span> <span class="k">return</span> <span class="n">_bootstrap</span><span class="o">.</span><span class="n">_gcd_import</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">level</span><span class="p">:],</span> <span class="n">package</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

<span class="nn">File &lt;frozen importlib._bootstrap&gt;:1030,</span> in <span class="ni">_gcd_import</span><span class="nt">(name, package, level)</span>

<span class="nn">File &lt;frozen importlib._bootstrap&gt;:1007,</span> in <span class="ni">_find_and_load</span><span class="nt">(name, import_)</span>

<span class="nn">File &lt;frozen importlib._bootstrap&gt;:984,</span> in <span class="ni">_find_and_load_unlocked</span><span class="nt">(name, import_)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;pycodestyle_magic&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define file paths</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Paths</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Singleton object for storing paths to data and database.&#39;&#39;&#39;</span>

    <span class="n">image</span> <span class="o">=</span> <span class="s1">&#39;./external_images&#39;</span>
    <span class="n">aace</span> <span class="o">=</span> <span class="s1">&#39;aace-map-all.png&#39;</span>
    <span class="n">pollitt</span> <span class="o">=</span> <span class="s1">&#39;pollitt-map.png&#39;</span>
    <span class="n">hsi_ccg</span> <span class="o">=</span> <span class="s1">&#39;hampshire_southampton_isleofwight_ccg.png&#39;</span>
    <span class="n">scas</span> <span class="o">=</span> <span class="s1">&#39;SCAS-map.png&#39;</span>
    <span class="n">eeas</span> <span class="o">=</span> <span class="s1">&#39;our-station-map.jpg&#39;</span>
    <span class="n">blmk</span> <span class="o">=</span> <span class="s1">&#39;BLMK_Map.png&#39;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;./data&#39;</span>
    <span class="n">collated</span> <span class="o">=</span> <span class="s1">&#39;collated_data.csv&#39;</span>
    <span class="n">collated_amb</span> <span class="o">=</span> <span class="s1">&#39;collated_data_amb.csv&#39;</span>

    <span class="n">look_ups</span> <span class="o">=</span> <span class="s1">&#39;look_ups&#39;</span>
    <span class="n">lsoa_to_lad</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;LSOA_(2011)_to_LSOA_(2021)_to_Local_Authority_District&#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;_(2022)_Lookup_for_England_and_Wales_(Version_2).csv&#39;</span><span class="p">)</span>
    <span class="n">lad_to_country</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Local_Authority_District_to_Country_(December_2022)&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;_Lookup_in_the_United_Kingdom.csv&#39;</span><span class="p">)</span>
    <span class="n">lsoa_to_ccg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lower_Layer_Super_Output_Area_(2011)_to_Clinical_&#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;Commissioning_Group_to_Local_Authority_District_(April_&#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;2021)_Lookup_in_England.csv&#39;</span><span class="p">)</span>

    <span class="n">demographic</span> <span class="o">=</span> <span class="s1">&#39;demographic&#39;</span>
    <span class="n">ccg_to_amb</span> <span class="o">=</span> <span class="s1">&#39;ambulance_service_info_ccg_lookup.csv&#39;</span>


<span class="n">paths</span> <span class="o">=</span> <span class="n">Paths</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="background">
<h2>3 Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<section id="existing-maps-of-ambulance-boundaries">
<h3>3.1 Existing maps of ambulance boundaries<a class="headerlink" href="#existing-maps-of-ambulance-boundaries" title="Permalink to this heading">#</a></h3>
<p>The Association of Ambulance Chief Executives provide an interactive map <a class="reference external" href="https://aace.org.uk/uk-ambulance-service/map-of-nhs-ambulance-services/">on their website</a> (screenshot copied below) that shows the ambulance boundaries. We have been advised by Steve Irving (Executive Officer / ALF Conference Lead) that the map “is just an approximation of the boundaries, purely for illustrative / navigational purposes”.</p>
<p>In England and Wales, there are 12 ambulance services:</p>
<ol class="arabic simple">
<li><p>East Midlands Ambulance Service (EMAS)</p></li>
<li><p>East of England Ambulance Service Trust (EEAST)</p></li>
<li><p>London Ambulance Service (LAS)</p></li>
<li><p>North East Ambulance Service (NEAS)</p></li>
<li><p>North West Ambulance Service (NWAS)</p></li>
<li><p>South Central Ambulance Service (SCAS)</p></li>
<li><p>South East Coast Ambulance Service (SECAmb)</p></li>
<li><p>West Midlands Ambulance Service (WMAS)</p></li>
<li><p>South West Ambulance Service (SWAS)</p></li>
<li><p>Yorkshire Ambulance Service (YAS)</p></li>
<li><p>Welsh Ambulance Service (WAS)</p></li>
<li><p>Isle of Wight Ambulance Service</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display images side-by-side</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">aace</span><span class="p">))))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">pollitt</span><span class="p">))))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3bfcc840db2429c0ca616024388d65a6dde255eda21e4ffd76c2f5b2cca454be.png" src="_images/3bfcc840db2429c0ca616024388d65a6dde255eda21e4ffd76c2f5b2cca454be.png" />
</div>
</div>
</section>
<section id="existing-spreadsheets-which-identify-ambulance-boundaries">
<h3>3.2 Existing spreadsheets which identify ambulance boundaries<a class="headerlink" href="#existing-spreadsheets-which-identify-ambulance-boundaries" title="Permalink to this heading">#</a></h3>
<p>We can link together two dataframes that take us from <strong>LSOA to CCG</strong> and then <strong>CCG to Ambulance Service</strong>. The second file, <code class="docutils literal notranslate"><span class="pre">ambulance_service_info_ccg_lookup.csv</span></code>, was created from ambulance_service_info.xlsx, with the removal of the two CCGs with complications (which did not have data in the file and just said “More than one” in the ambulance service columns.)</p>
<p>There are <strong>three complications</strong>, which are explained in more detail in their sections of the notebook below:</p>
<ul class="simple">
<li><p>NHS Hampshire, Southampton, and Isle of Wight CCG is covered by two different ambulance services</p></li>
<li><p>NHS Bedfordshire, Luton and Milton Keynes CCG is covered by two different ambulance services</p></li>
<li><p>Wales is not included in the spreadsheet</p></li>
</ul>
</section>
</section>
<section id="create-lsoa-to-ambulance-service-based-on-lookup-files">
<h2>4 Create LSOA to Ambulance Service based on lookup files<a class="headerlink" href="#create-lsoa-to-ambulance-service-based-on-lookup-files" title="Permalink to this heading">#</a></h2>
<p>Load file with LSOA to CCG</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the LSOA to CCG look-up</span>
<span class="n">lsoa_ccg_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">look_ups</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">lsoa_to_ccg</span><span class="p">),</span>
    <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;CCG21NM&#39;</span><span class="p">)</span>

<span class="n">lsoa_ccg_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FID</th>
      <th>LSOA11CD</th>
      <th>LSOA11NM</th>
      <th>CCG21CD</th>
      <th>CCG21CDH</th>
      <th>LAD21CD</th>
      <th>LAD21NM</th>
    </tr>
    <tr>
      <th>CCG21NM</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>NHS Barnsley CCG</th>
      <td>1</td>
      <td>E01007420</td>
      <td>Barnsley 016C</td>
      <td>E38000006</td>
      <td>02P</td>
      <td>E08000016</td>
      <td>Barnsley</td>
    </tr>
    <tr>
      <th>NHS Barnsley CCG</th>
      <td>2</td>
      <td>E01007317</td>
      <td>Barnsley 018A</td>
      <td>E38000006</td>
      <td>02P</td>
      <td>E08000016</td>
      <td>Barnsley</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Load file with CCG to ambulance trust</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the CCG to ambulance look-up</span>
<span class="n">ccg_amb_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">look_ups</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">ccg_to_amb</span><span class="p">),</span>
    <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;CCG name&#39;</span><span class="p">)</span>

<span class="c1"># Remove trailing whitespace from column names</span>
<span class="n">ccg_amb_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">ccg_amb_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

<span class="c1"># Preview dataframe</span>
<span class="n">ccg_amb_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NHS CCG code</th>
      <th>Office for National Statistics (ONS) April 2021 CCG code</th>
      <th>Ambulance Service</th>
      <th>NHS Ambulance Service Region Name</th>
      <th>NHS Ambulance Service Region code</th>
      <th>ONS Ambulance Service Region Code</th>
    </tr>
    <tr>
      <th>CCG name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>NHS Bassetlaw CCG</th>
      <td>02Q</td>
      <td>E38000008</td>
      <td>EMAS</td>
      <td>Midlands</td>
      <td>Y60</td>
      <td>E40000008</td>
    </tr>
    <tr>
      <th>NHS East Leicestershire and Rutland CCG</th>
      <td>03W</td>
      <td>E38000051</td>
      <td>EMAS</td>
      <td>Midlands</td>
      <td>Y60</td>
      <td>E40000008</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Add column with unique, full name for each ambulance service to the CCG to Ambulance file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create dictionary with guide to full ambulance service names</span>
<span class="n">dict_amb_service_name</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;EMAS&#39;</span><span class="p">:</span> <span class="s1">&#39;East Midlands&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;EEAST&#39;</span><span class="p">:</span> <span class="s1">&#39;East of England&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;LAS&#39;</span><span class="p">:</span> <span class="s1">&#39;London&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;NEAS&#39;</span><span class="p">:</span> <span class="s1">&#39;North East&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;NWAS&#39;</span><span class="p">:</span> <span class="s1">&#39;North West&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;SCAS&#39;</span><span class="p">:</span> <span class="s1">&#39;South Central&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;SECAmb&#39;</span><span class="p">:</span> <span class="s1">&#39;South East Coast&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;WMAS&#39;</span><span class="p">:</span> <span class="s1">&#39;West Midlands&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;SWAS&#39;</span><span class="p">:</span> <span class="s1">&#39;South West&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;YAS&#39;</span><span class="p">:</span> <span class="s1">&#39;Yorkshire&#39;</span><span class="p">}</span>

<span class="c1"># Add full ambulance service name, based on the data dictionary</span>
<span class="n">ccg_amb_data</span><span class="p">[</span><span class="s1">&#39;Ambulance Service Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ccg_amb_data</span><span class="p">[</span><span class="s1">&#39;Ambulance Service&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_amb_service_name</span><span class="p">))</span>

<span class="c1"># Preview dataframe</span>
<span class="n">ccg_amb_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NHS CCG code</th>
      <th>Office for National Statistics (ONS) April 2021 CCG code</th>
      <th>Ambulance Service</th>
      <th>NHS Ambulance Service Region Name</th>
      <th>NHS Ambulance Service Region code</th>
      <th>ONS Ambulance Service Region Code</th>
      <th>Ambulance Service Name</th>
    </tr>
    <tr>
      <th>CCG name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>NHS Bassetlaw CCG</th>
      <td>02Q</td>
      <td>E38000008</td>
      <td>EMAS</td>
      <td>Midlands</td>
      <td>Y60</td>
      <td>E40000008</td>
      <td>East Midlands</td>
    </tr>
    <tr>
      <th>NHS East Leicestershire and Rutland CCG</th>
      <td>03W</td>
      <td>E38000051</td>
      <td>EMAS</td>
      <td>Midlands</td>
      <td>Y60</td>
      <td>E40000008</td>
      <td>East Midlands</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Add the CCG to Ambulance fields to the LSOA to CCG dataset (by matching on CCG name - make that the index for both datasets before joining)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Join LSOA-CCG and CCG-Ambulance based on index (which is the CCG name)</span>
<span class="n">lsoa_amb_data</span> <span class="o">=</span> <span class="n">lsoa_ccg_data</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ccg_amb_data</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Set dataframe index to LSOA</span>
<span class="n">lsoa_amb_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;LSOA11CD&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Preview dataframe</span>
<span class="n">lsoa_amb_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CCG21NM</th>
      <th>FID</th>
      <th>LSOA11NM</th>
      <th>CCG21CD</th>
      <th>CCG21CDH</th>
      <th>LAD21CD</th>
      <th>LAD21NM</th>
      <th>NHS CCG code</th>
      <th>Office for National Statistics (ONS) April 2021 CCG code</th>
      <th>Ambulance Service</th>
      <th>NHS Ambulance Service Region Name</th>
      <th>NHS Ambulance Service Region code</th>
      <th>ONS Ambulance Service Region Code</th>
      <th>Ambulance Service Name</th>
    </tr>
    <tr>
      <th>LSOA11CD</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>E01007420</th>
      <td>NHS Barnsley CCG</td>
      <td>1</td>
      <td>Barnsley 016C</td>
      <td>E38000006</td>
      <td>02P</td>
      <td>E08000016</td>
      <td>Barnsley</td>
      <td>02P</td>
      <td>E38000006</td>
      <td>YAS</td>
      <td>North East and Yorkshire</td>
      <td>Y63</td>
      <td>E40000009</td>
      <td>Yorkshire</td>
    </tr>
    <tr>
      <th>E01007317</th>
      <td>NHS Barnsley CCG</td>
      <td>2</td>
      <td>Barnsley 018A</td>
      <td>E38000006</td>
      <td>02P</td>
      <td>E08000016</td>
      <td>Barnsley</td>
      <td>02P</td>
      <td>E38000006</td>
      <td>YAS</td>
      <td>North East and Yorkshire</td>
      <td>Y63</td>
      <td>E40000009</td>
      <td>Yorkshire</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="add-nhs-hampshire-southampton-and-isle-of-wight-ccg">
<h2>5 Add NHS Hampshire, Southampton and Isle of Wight CCG<a class="headerlink" href="#add-nhs-hampshire-southampton-and-isle-of-wight-ccg" title="Permalink to this heading">#</a></h2>
<section id="maps">
<h3>5.1 Maps<a class="headerlink" href="#maps" title="Permalink to this heading">#</a></h3>
<p>As you can see from the maps, this CCG includes areas from Hampshire and Isle of Wight (and does not, for example, include Portsmouth or North East Hampshire, which are part of different CCGs).</p>
<p>Of the areas in the CCG:</p>
<ul class="simple">
<li><p>The <strong>South Central Ambulance Service</strong> (SCAS) covers Hampshire</p></li>
<li><p>The <strong>Isle of Wight Ambulance Service</strong> covers the Isle of Wight</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display images side-by-side</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">hsi_ccg</span><span class="p">))))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CCG (contains Hampshire + Isle of Wight)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">scas</span><span class="p">))))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SCAS (can see does not contain Isle of Wight)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/633827a09d47f10255c014ce8bc5841587405bb6c07d479e0dc2ea1079b006ca.png" src="_images/633827a09d47f10255c014ce8bc5841587405bb6c07d479e0dc2ea1079b006ca.png" />
</div>
</div>
</section>
<section id="add-appropriate-service-to-each-lsoa">
<h3>5.2 Add appropriate service to each LSOA<a class="headerlink" href="#add-appropriate-service-to-each-lsoa" title="Permalink to this heading">#</a></h3>
<p>Assign LSOAs in Isle of Wight to the Isle of Wight Ambulance Service. Assign the remaining LSOAs to the South Central Ambulance Service.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find LSOAs in that CCG</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">lsoa_amb_data</span><span class="p">[</span><span class="s1">&#39;CCG21NM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Hampshire&#39;</span><span class="p">)</span>

<span class="c1"># Set the ambulance service as South Central (SCAS)</span>
<span class="n">lsoa_amb_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;Ambulance Service Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;South Central&#39;</span>

<span class="c1"># From those LSOAs, identify those that are in the Isle of Wight</span>
<span class="n">mask2</span> <span class="o">=</span> <span class="n">lsoa_amb_data</span><span class="p">[</span><span class="s1">&#39;LSOA11NM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Isle of Wight&#39;</span><span class="p">)</span>

<span class="c1"># Replace the ambulance service for those to Isle of Wight</span>
<span class="n">lsoa_amb_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask2</span><span class="p">,</span> <span class="s1">&#39;Ambulance Service Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Isle of Wight&#39;</span>

<span class="c1"># View resulting number of LSOA from that CCG in each service</span>
<span class="n">lsoa_amb_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;Ambulance Service Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ambulance Service Name
South Central    879
Isle of Wight     89
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="add-nhs-bedfordshire-luton-and-milton-keynes-ccg">
<h2>6 Add NHS Bedfordshire, Luton and Milton Keynes CCG<a class="headerlink" href="#add-nhs-bedfordshire-luton-and-milton-keynes-ccg" title="Permalink to this heading">#</a></h2>
<section id="maps-and-information-about-the-area">
<h3>6.1 Maps and information about the area<a class="headerlink" href="#maps-and-information-about-the-area" title="Permalink to this heading">#</a></h3>
<p>This CCG contains:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Local authority</p></th>
<th class="head"><p>County</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Central Bedfordshire</p></td>
<td><p>Bedfordshire</p></td>
</tr>
<tr class="row-odd"><td><p>Luton</p></td>
<td><p>Bedfordshire</p></td>
</tr>
<tr class="row-even"><td><p>Bedford</p></td>
<td><p>Bedfordshire</p></td>
</tr>
<tr class="row-odd"><td><p>Milton Keynes</p></td>
<td><p>Buckinghamshire</p></td>
</tr>
<tr class="row-even"><td><p>Buckinghamshire</p></td>
<td><p>Buckinghamshire</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lsoa_ccg_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="s1">&#39;NHS Bedfordshire, Luton and Milton Keynes CCG&#39;</span><span class="p">,</span> <span class="s1">&#39;LAD21NM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LAD21NM
Central Bedfordshire    157
Milton Keynes           152
Luton                   121
Bedford                 103
Buckinghamshire           4
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>It is covered by two ambulance services: (1) East of England Ambulance Service, and (2) South Central Ambulance Service.</p>
<p>To deal with this:</p>
<ul class="simple">
<li><p>LSOAs in Bedfordshire were assigned to East of England Ambulance Service</p></li>
<li><p>LSOAs in Buckinghamshire were assigned to South Central Ambulance Service</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display images side-by-side</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">blmk</span><span class="p">))))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CCG&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">scas</span><span class="p">))))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SCAS&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">eeas</span><span class="p">))))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;EEAS&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9b46db89d41250f134be36c6635b7c5b99ba583c2385c2810ad8ffcfe56f194c.png" src="_images/9b46db89d41250f134be36c6635b7c5b99ba583c2385c2810ad8ffcfe56f194c.png" />
</div>
</div>
</section>
<section id="add-appropriate-services-based-on-county">
<h3>6.2 Add appropriate services based on county<a class="headerlink" href="#add-appropriate-services-based-on-county" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identify LSOAs from the CCG in Bedfordshire</span>
<span class="n">bed_mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">lsoa_amb_data</span><span class="p">[</span><span class="s1">&#39;CCG21NM&#39;</span><span class="p">]</span> <span class="o">==</span>
             <span class="s1">&#39;NHS Bedfordshire, Luton and Milton Keynes CCG&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">lsoa_amb_data</span><span class="p">[</span><span class="s1">&#39;LAD21NM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span>
                <span class="s1">&#39;Central Bedfordshire&#39;</span><span class="p">,</span> <span class="s1">&#39;Luton&#39;</span><span class="p">,</span> <span class="s1">&#39;Bedford&#39;</span><span class="p">])))</span>

<span class="c1"># Set ambulance service to East of England</span>
<span class="n">lsoa_amb_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bed_mask</span><span class="p">,</span> <span class="s1">&#39;Ambulance Service Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;East of England&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identify LSOAs from the CCG in Buckinghamshire</span>
<span class="n">buc_mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">lsoa_amb_data</span><span class="p">[</span><span class="s1">&#39;CCG21NM&#39;</span><span class="p">]</span> <span class="o">==</span>
             <span class="s1">&#39;NHS Bedfordshire, Luton and Milton Keynes CCG&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">lsoa_amb_data</span><span class="p">[</span><span class="s1">&#39;LAD21NM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span>
                <span class="s1">&#39;Milton Keynes&#39;</span><span class="p">,</span> <span class="s1">&#39;Buckinghamshire&#39;</span><span class="p">])))</span>

<span class="c1"># Set ambulance service to South Central</span>
<span class="n">lsoa_amb_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">buc_mask</span><span class="p">,</span> <span class="s1">&#39;Ambulance Service Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;South Central&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="add-services-to-collated-data-csv">
<h2>7 Add services to collated_data.csv<a class="headerlink" href="#add-services-to-collated-data-csv" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import collated data</span>
<span class="n">collated</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">collated</span><span class="p">),</span>
                       <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;LSOA&#39;</span><span class="p">)</span>
<span class="n">collated</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>admissions</th>
      <th>closest_ivt_unit</th>
      <th>closest_ivt_unit_time</th>
      <th>closest_mt_unit</th>
      <th>closest_mt_unit_time</th>
      <th>closest_mt_transfer</th>
      <th>closest_mt_transfer_time</th>
      <th>total_mt_time</th>
      <th>ivt_rate</th>
      <th>imd_2019_score</th>
      <th>...</th>
      <th>age_band_males_45</th>
      <th>age_band_males_50</th>
      <th>age_band_males_55</th>
      <th>age_band_males_60</th>
      <th>age_band_males_65</th>
      <th>age_band_males_70</th>
      <th>age_band_males_75</th>
      <th>age_band_males_80</th>
      <th>age_band_males_85</th>
      <th>age_band_males_90</th>
    </tr>
    <tr>
      <th>LSOA</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Welwyn Hatfield 010F</th>
      <td>0.666667</td>
      <td>SG14AB</td>
      <td>18.7</td>
      <td>NW12BU</td>
      <td>36.9</td>
      <td>CB20QQ</td>
      <td>39.1</td>
      <td>57.8</td>
      <td>6.8</td>
      <td>15.616</td>
      <td>...</td>
      <td>47</td>
      <td>66</td>
      <td>59</td>
      <td>28</td>
      <td>33</td>
      <td>28</td>
      <td>26</td>
      <td>14</td>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Welwyn Hatfield 012A</th>
      <td>4.000000</td>
      <td>SG14AB</td>
      <td>19.8</td>
      <td>NW12BU</td>
      <td>36.9</td>
      <td>CB20QQ</td>
      <td>39.1</td>
      <td>58.9</td>
      <td>6.8</td>
      <td>33.313</td>
      <td>...</td>
      <td>62</td>
      <td>60</td>
      <td>80</td>
      <td>53</td>
      <td>24</td>
      <td>18</td>
      <td>21</td>
      <td>12</td>
      <td>5</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 110 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter, rename and reindex lsoa_amb_data so ready to join</span>
<span class="n">lsoa_amb</span> <span class="o">=</span> <span class="p">(</span><span class="n">lsoa_amb_data</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;LSOA11NM&#39;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Ambulance Service Name&#39;</span><span class="p">:</span> <span class="s1">&#39;ambulance_service&#39;</span><span class="p">}))</span>
<span class="n">lsoa_amb</span> <span class="o">=</span> <span class="n">lsoa_amb</span><span class="p">[</span><span class="s1">&#39;ambulance_service&#39;</span><span class="p">]</span>
<span class="n">lsoa_amb</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LSOA11NM
Barnsley 016C    Yorkshire
Barnsley 018A    Yorkshire
Name: ambulance_service, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Join ambulance services to collated data based on index (LSOA)</span>
<span class="n">collated_amb</span> <span class="o">=</span> <span class="n">collated</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lsoa_amb</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="add-wales-to-collated-data-csv">
<h2>8 Add Wales to collated_data.csv<a class="headerlink" href="#add-wales-to-collated-data-csv" title="Permalink to this heading">#</a></h2>
<p>Wales was not included in the lookup files used to create LSOA_amb_data. Wales is covered by a single ambulance service.</p>
<p>Add local authority district to collated data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import file with LSOA to Local Authority for England and Wales</span>
<span class="n">lsoa_lad</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">look_ups</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">lsoa_to_lad</span><span class="p">),</span>
    <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;LSOA11NM&#39;</span><span class="p">)</span>

<span class="c1"># Add local authority district to collated data</span>
<span class="n">lsoa_lad</span> <span class="o">=</span> <span class="n">lsoa_lad</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;LAD22NM&#39;</span><span class="p">:</span> <span class="s1">&#39;local_authority_district_22&#39;</span><span class="p">})</span>
<span class="n">collated_amb</span> <span class="o">=</span> <span class="n">collated_amb</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lsoa_lad</span><span class="p">[</span><span class="s1">&#39;local_authority_district_22&#39;</span><span class="p">])</span>

<span class="c1"># Preview dataframe</span>
<span class="n">collated_amb</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>admissions</th>
      <th>closest_ivt_unit</th>
      <th>closest_ivt_unit_time</th>
      <th>closest_mt_unit</th>
      <th>closest_mt_unit_time</th>
      <th>closest_mt_transfer</th>
      <th>closest_mt_transfer_time</th>
      <th>total_mt_time</th>
      <th>ivt_rate</th>
      <th>imd_2019_score</th>
      <th>...</th>
      <th>age_band_males_55</th>
      <th>age_band_males_60</th>
      <th>age_band_males_65</th>
      <th>age_band_males_70</th>
      <th>age_band_males_75</th>
      <th>age_band_males_80</th>
      <th>age_band_males_85</th>
      <th>age_band_males_90</th>
      <th>ambulance_service</th>
      <th>local_authority_district_22</th>
    </tr>
    <tr>
      <th>LSOA</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Welwyn Hatfield 010F</th>
      <td>0.666667</td>
      <td>SG14AB</td>
      <td>18.7</td>
      <td>NW12BU</td>
      <td>36.9</td>
      <td>CB20QQ</td>
      <td>39.1</td>
      <td>57.8</td>
      <td>6.8</td>
      <td>15.616</td>
      <td>...</td>
      <td>59</td>
      <td>28</td>
      <td>33</td>
      <td>28</td>
      <td>26</td>
      <td>14</td>
      <td>5</td>
      <td>3</td>
      <td>East of England</td>
      <td>Welwyn Hatfield</td>
    </tr>
    <tr>
      <th>Welwyn Hatfield 012A</th>
      <td>4.000000</td>
      <td>SG14AB</td>
      <td>19.8</td>
      <td>NW12BU</td>
      <td>36.9</td>
      <td>CB20QQ</td>
      <td>39.1</td>
      <td>58.9</td>
      <td>6.8</td>
      <td>33.313</td>
      <td>...</td>
      <td>80</td>
      <td>53</td>
      <td>24</td>
      <td>18</td>
      <td>21</td>
      <td>12</td>
      <td>5</td>
      <td>4</td>
      <td>East of England</td>
      <td>Welwyn Hatfield</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 112 columns</p>
</div></div></div>
</div>
<p>Add country to collated data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import file with Local Authority to Country</span>
<span class="n">lad_country</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">look_ups</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">lad_to_country</span><span class="p">))</span>

<span class="c1"># Rename country</span>
<span class="n">lad_country</span> <span class="o">=</span> <span class="n">lad_country</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;CTRY22NM&#39;</span><span class="p">:</span> <span class="s1">&#39;country&#39;</span><span class="p">})</span>

<span class="c1"># Merge with collated_amb</span>
<span class="n">collated_amb</span> <span class="o">=</span> <span class="p">(</span><span class="n">collated_amb</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lad_country</span><span class="p">[[</span><span class="s1">&#39;LAD22NM&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">]],</span>
                       <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                       <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;local_authority_district_22&#39;</span><span class="p">,</span>
                       <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;LAD22NM&#39;</span><span class="p">,)</span>
                <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;LSOA&#39;</span><span class="p">))</span>

<span class="c1"># Preview dataframe</span>
<span class="n">collated_amb</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>admissions</th>
      <th>closest_ivt_unit</th>
      <th>closest_ivt_unit_time</th>
      <th>closest_mt_unit</th>
      <th>closest_mt_unit_time</th>
      <th>closest_mt_transfer</th>
      <th>closest_mt_transfer_time</th>
      <th>total_mt_time</th>
      <th>ivt_rate</th>
      <th>imd_2019_score</th>
      <th>...</th>
      <th>age_band_males_65</th>
      <th>age_band_males_70</th>
      <th>age_band_males_75</th>
      <th>age_band_males_80</th>
      <th>age_band_males_85</th>
      <th>age_band_males_90</th>
      <th>ambulance_service</th>
      <th>local_authority_district_22</th>
      <th>LAD22NM</th>
      <th>country</th>
    </tr>
    <tr>
      <th>LSOA</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Welwyn Hatfield 010F</th>
      <td>0.666667</td>
      <td>SG14AB</td>
      <td>18.7</td>
      <td>NW12BU</td>
      <td>36.9</td>
      <td>CB20QQ</td>
      <td>39.1</td>
      <td>57.8</td>
      <td>6.8</td>
      <td>15.616</td>
      <td>...</td>
      <td>33</td>
      <td>28</td>
      <td>26</td>
      <td>14</td>
      <td>5</td>
      <td>3</td>
      <td>East of England</td>
      <td>Welwyn Hatfield</td>
      <td>Welwyn Hatfield</td>
      <td>England</td>
    </tr>
    <tr>
      <th>Welwyn Hatfield 012A</th>
      <td>4.000000</td>
      <td>SG14AB</td>
      <td>19.8</td>
      <td>NW12BU</td>
      <td>36.9</td>
      <td>CB20QQ</td>
      <td>39.1</td>
      <td>58.9</td>
      <td>6.8</td>
      <td>33.313</td>
      <td>...</td>
      <td>24</td>
      <td>18</td>
      <td>21</td>
      <td>12</td>
      <td>5</td>
      <td>4</td>
      <td>East of England</td>
      <td>Welwyn Hatfield</td>
      <td>Welwyn Hatfield</td>
      <td>England</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 114 columns</p>
</div></div></div>
</div>
<p>Set ambulance service to Wales to all LSOA in Wales</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find LSOA in Wales and set ambulance service to Welsh</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">collated_amb</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Wales&#39;</span>
<span class="n">collated_amb</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;ambulance_service&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Welsh&#39;</span>

<span class="c1"># Preview dataframe</span>
<span class="n">collated_amb</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>admissions</th>
      <th>closest_ivt_unit</th>
      <th>closest_ivt_unit_time</th>
      <th>closest_mt_unit</th>
      <th>closest_mt_unit_time</th>
      <th>closest_mt_transfer</th>
      <th>closest_mt_transfer_time</th>
      <th>total_mt_time</th>
      <th>ivt_rate</th>
      <th>imd_2019_score</th>
      <th>...</th>
      <th>age_band_males_65</th>
      <th>age_band_males_70</th>
      <th>age_band_males_75</th>
      <th>age_band_males_80</th>
      <th>age_band_males_85</th>
      <th>age_band_males_90</th>
      <th>ambulance_service</th>
      <th>local_authority_district_22</th>
      <th>LAD22NM</th>
      <th>country</th>
    </tr>
    <tr>
      <th>LSOA</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Welwyn Hatfield 010F</th>
      <td>0.666667</td>
      <td>SG14AB</td>
      <td>18.7</td>
      <td>NW12BU</td>
      <td>36.9</td>
      <td>CB20QQ</td>
      <td>39.1</td>
      <td>57.8</td>
      <td>6.8</td>
      <td>15.616</td>
      <td>...</td>
      <td>33</td>
      <td>28</td>
      <td>26</td>
      <td>14</td>
      <td>5</td>
      <td>3</td>
      <td>East of England</td>
      <td>Welwyn Hatfield</td>
      <td>Welwyn Hatfield</td>
      <td>England</td>
    </tr>
    <tr>
      <th>Welwyn Hatfield 012A</th>
      <td>4.000000</td>
      <td>SG14AB</td>
      <td>19.8</td>
      <td>NW12BU</td>
      <td>36.9</td>
      <td>CB20QQ</td>
      <td>39.1</td>
      <td>58.9</td>
      <td>6.8</td>
      <td>33.313</td>
      <td>...</td>
      <td>24</td>
      <td>18</td>
      <td>21</td>
      <td>12</td>
      <td>5</td>
      <td>4</td>
      <td>East of England</td>
      <td>Welwyn Hatfield</td>
      <td>Welwyn Hatfield</td>
      <td>England</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 114 columns</p>
</div></div></div>
</div>
</section>
<section id="save-file">
<h2>9 Save file<a class="headerlink" href="#save-file" title="Permalink to this heading">#</a></h2>
<p>Check all LSOA have an ambulance service</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collated_amb</span><span class="p">[</span><span class="s1">&#39;ambulance_service&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ambulance_service
London              4835
North West          4521
East of England     3623
West Midlands       3487
South West          3284
South East Coast    3118
Yorkshire           3107
East Midlands       2951
South Central       2171
Welsh               1909
North East          1657
Isle of Wight         89
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Save as csv</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collated_amb</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">paths</span><span class="o">.</span><span class="n">collated_amb</span><span class="p">),</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;LSOA&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="01_combine_demographic_data.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Collate demographic data for each LSOA</p>
      </div>
    </a>
    <a class="right-next"
       href="02_create_shapefiles.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Create shapefiles</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">1 Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages-and-set-file-paths">2 Import packages and set file paths</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">3 Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#existing-maps-of-ambulance-boundaries">3.1 Existing maps of ambulance boundaries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#existing-spreadsheets-which-identify-ambulance-boundaries">3.2 Existing spreadsheets which identify ambulance boundaries</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-lsoa-to-ambulance-service-based-on-lookup-files">4 Create LSOA to Ambulance Service based on lookup files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-nhs-hampshire-southampton-and-isle-of-wight-ccg">5 Add NHS Hampshire, Southampton and Isle of Wight CCG</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maps">5.1 Maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-appropriate-service-to-each-lsoa">5.2 Add appropriate service to each LSOA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-nhs-bedfordshire-luton-and-milton-keynes-ccg">6 Add NHS Bedfordshire, Luton and Milton Keynes CCG</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maps-and-information-about-the-area">6.1 Maps and information about the area</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-appropriate-services-based-on-county">6.2 Add appropriate services based on county</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-services-to-collated-data-csv">7 Add services to collated_data.csv</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-wales-to-collated-data-csv">8 Add Wales to collated_data.csv</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-file">9 Save file</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By SAMueL-2 team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>